import React, { useState } from 'react';
import Icon from '../../../components/AppIcon';

const FileTreeViewer = ({ fileTree, onFileSelect }) => {
  const [expandedFolders, setExpandedFolders] = useState(new Set(['root']));

  const toggleFolder = (path) => {
    const newExpanded = new Set(expandedFolders);
    if (newExpanded?.has(path)) {
      newExpanded?.delete(path);
    } else {
      newExpanded?.add(path);
    }
    setExpandedFolders(newExpanded);
  };

  const renderTreeNode = (node, level = 0) => {
    const isExpanded = expandedFolders?.has(node?.path);
    const hasChildren = node?.children && node?.children?.length > 0;

    return (
      <div key={node?.path}>
        <div
          className={`flex items-center gap-2 py-2 px-3 rounded-md cursor-pointer transition-colors hover:bg-muted ${
            node?.isSelected ? 'bg-primary/10 text-primary' : 'text-foreground'
          }`}
          style={{ paddingLeft: `${level * 20 + 12}px` }}
          onClick={() => {
            if (node?.type === 'folder') {
              toggleFolder(node?.path);
            } else {
              onFileSelect(node);
            }
          }}
        >
          {node?.type === 'folder' ? (
            <>
              <Icon 
                name={isExpanded ? 'ChevronDown' : 'ChevronRight'} 
                size={16} 
                className="flex-shrink-0"
              />
              <Icon 
                name={isExpanded ? 'FolderOpen' : 'Folder'} 
                size={16} 
                className="flex-shrink-0"
              />
            </>
          ) : (
            <>
              <span className="w-4" />
              <Icon name="FileCode" size={16} className="flex-shrink-0" />
            </>
          )}
          <span className="text-sm truncate">{node?.name}</span>
          {node?.vulnerabilityCount > 0 && (
            <span className="ml-auto text-xs px-2 py-0.5 rounded-full bg-error/10 text-error font-medium">
              {node?.vulnerabilityCount}
            </span>
          )}
        </div>
        {hasChildren && isExpanded && (
          <div>
            {node?.children?.map(child => renderTreeNode(child, level + 1))}
          </div>
        )}
      </div>
    );
  };

  return (
    <div className="bg-card rounded-lg border border-border overflow-hidden">
      <div className="bg-muted px-4 py-3 border-b border-border">
        <h3 className="text-sm font-semibold text-foreground flex items-center gap-2">
          <Icon name="FolderTree" size={18} />
          Project Structure
        </h3>
      </div>
      <div className="p-2 max-h-[600px] overflow-y-auto">
        {fileTree?.map(node => renderTreeNode(node))}
      </div>
    </div>
  );
};

export default FileTreeViewer;